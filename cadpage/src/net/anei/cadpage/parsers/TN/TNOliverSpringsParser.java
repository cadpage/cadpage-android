package net.anei.cadpage.parsers.TN;

import java.util.regex.Pattern;

import net.anei.cadpage.parsers.FieldProgramParser;
import net.anei.cadpage.parsers.MsgInfo.Data;

/*
Oliver Springs, TN 
Contact: Active911
Agency name: Oliver Springs Fire Department Location: Oliver Springs, TN 
Sender: page@ospd.com

(PRISONER TRANSPORT)\nANDERSON CO JAIL, OLIVER SPRINGS, TN, 37840 - CALL:PRISONER TRANSPORT - REC:14:15 - DISP:19:15 - NOTE:WENT TO ANDERSON CO JAIL TO PICK UP BRANDY BRADEN TO BRING BACK FOR JUDGE TO SEE AND BACK TO ANDERSON CO JAIL.\nBEG. MIL 54263 ENDING AT JUDGE'S OFFICER 54278 -  TRK#:8911
(COURT)\nOAK RIDGE COURT, OLIVER SPRINGS, TN, 37840 - CALL:COURT - REC:08:30 - DISP:08:30 - NOTE:COURT OAK RIDGE -  TRK#:8931
(HOUSE FIRE)\n1126 LOOKOUT AVE, OLIVER SPRINGS, TN, 37840 - CALL:HOUSE FIRE - REC:11:08 - DISP:11:08 - NOTE:THIS IS A TEST CALL DO NOT RESPOND -  TRK#:8933
(FIRE)\n508 E TRI COUNTY BLVD, OLIVER SPRINGS, TN, 37840 - CALL:FIRE - REC:16:20 - DISP:16:21 - NOTE:FIRE AT FOOD CITY---TEST ONLY---REPEAT TEST ONLY -  TRK#:8941
(FIRE)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRE - REC:11:37 - DISP:11:37 - NOTE:STRUCTURE FIRE... TEST... TEST... TEST -  TRK#:8959
(FIRST RESPONDERS)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRST RESPONDERS - REC:11:38 - DISP:11:38 - NOTE:40 YOM CHEST PAINS EMS RESPONDING FROM THE RIDGE.. TEST.. TEST.. TEST..  -  TRK#:8960
(FIRE)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRE  - REC:11:39 - DISP:11:39 - NOTE:2 CAR MVA ... TEST... TEST.. TEST..  -  TRK#:8961
(FIRE)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRE - REC:11:40 - DISP:11:41 - NOTE:STRUCTURE FIRE.. TEST.. TEST.. TEST -  TRK#:8962
(FIRST RESPONDERS)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRST RESPONDERS  - REC:11:42 - DISP:11:42 - NOTE:88 YOM DIFF BREATHING EMS RESPONDING FROM QUARTERS  -  TRK#:8963
(FIRE)\n701 MAIN ST , OLIVER SPRINGS, TN, 37840 - CALL:FIRE  - REC:11:43 - DISP:11:43 - NOTE:ALL TEST CALLS NO ACTIVE CALLS AT THIS TIME.. INCLUDING THE LAST ONE.. THANKS -  TRK#:8964
(FIRST RESPONDERS)\n508 E TRI COUNTY BLVD, OLIVER SPRINGS, TN, 37840 - CALL:FIRST RESPONDERS - REC:13:57 - DISP:13:58 - NOTE:2 CAR MVA NO INJURIES\nNO RESPONSE NEEDED FOR ACTIVE 911 ACTIVATION ONLY -  TRK#:8968
(DOA)\n248 BURNEY DR, OLIVER SPRINGS, TN, 37840 - CALL:DOA - REC:11:24 - DISP:11:24 - NOTE:CALLER STATES THAT THERE IS A MALE SUBJECT ON THE PORCH POSSIBLE DOA. HE IS REQUESTING POLICE AND FIRST RESPONDERS.  -  TRK#:8983
(LIFT ASSIST)\n113 KREIS CIRCLE, OLIVER SPRINGS, TN, 37840 - CALL:LIFT ASSIST - REC:20:50 - DISP:20:51 - NOTE:COMPLAINANT REQUEST ASSISTANCE FOR LIFT ASSIST ONLY. FEMALE SUBJECT NEEDING ASSIST FROM CHAIR TO VAN, GOING BACK TO NURSING HOME. ADDRESS IS 113 KREIS CIRCLE. -  TRK#:8986
(VEHICLE FIRE)\nFROST BOTTOM, OLIVER SPRINGS, TN, 37840 - CALL:VEHICLE FIRE - REC:03:13 - DISP:03:13 - NOTE:VEHICLE FIRE FROST BOTTOM ANDERSON CO REQUESTING AUTOMATIC AID -  TRK#:9027
(ACCIDENT)\nWINTERGAP AND LOOKOUT AVE, OLIVER SPRINGS, TN, 37840 - CALL:ACCIDENT - REC:17:44 - DISP: - NOTE:ACCIDENT WITH INJURIES -  TRK#:9071
(LIFT ASSIST)\n214 WALDEN AVENUE, OLIVER SPRINGS, TN, 37840 - CALL:LIFT ASSIST - REC:17:32 - DISP:17:32 - NOTE:COMPLAINANT NEEDS LIFT ASSIST ONLY AT 214 WALDEN AVENUE. -  TRK#:9114
(MEDICAL ASSIST)\n710 SYCAMORE LN, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:03:28 - DISP:03:30 - NOTE:71 Y/O/F FELL AND IS NEEDING MEDICAL ATTENTION  -  TRK#:9126
(AUTOMATIC AID)\nWINDROCK MOUNTAIN, OLIVER SPRINGS, TN, 37840 - CALL:AUTOMATIC AID  - REC:11:30 - DISP:11:30 - NOTE:ANDERSON CO REQUESTING MUTUAL AID WINDROCK MOUNTAIN JUST BELOW THE WINDMILLS AT THE COMPRESS STATION NATURAL GAS TANK ON FIRE..  -  TRK#:9129
(FIRST RESPONDERS)\n118 OLD KNOX HWY, OLIVER SPRINGS, TN, 37840 - CALL:FIRST RESPONDERS - REC:01:06 - DISP: - NOTE:71 YEAR OLD MALE SHAKING POSSIBLE SEIZURE RUNNING FEVER -  TRK#:9158
(MEDICAL ASSIST)\n701 MAIN ST, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:19:36 - DISP:19:36 - NOTE: -  TRK#:9186
(MEDICAL ASSIST)\n640 BUTLER MILL RD, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:22:27 - DISP:22:29 - NOTE:REPORT OF A MALE WITH A UNKNOWN MEDICAL PROBLEM AT 640 BUTLERMILL RD. -  TRK#:9210
(FIRE)\n105 BRITAIN VILLAGE, OLIVER SPRINGS, TN, 37840 - CALL:FIRE - REC:05:59 - DISP:05:59 - NOTE:REPORTS APT ON FIRE  -  TRK#:9214
(MEDICAL ASSIST)\n308 TOWER DR, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:22:50 - DISP:22:51 - NOTE:ASSIST ANDERSON COUNTY EMS ON REPORT OF A MALE WHO HAS FALLEN WITH POSSIBLE INJURIES AT 308 TOWER DRIVE. -  TRK#:9263
(EMS)\n616 W TRI-COUNTY BLVD, OLIVER SPRINGS, TN, 37840 - CALL:EMS - REC:11:43 - DISP: - NOTE:ELDERLY FEMALE CALLED AND STATED THAT SHE HAS A RING STUCK ON HER FINGER. SHE STATES THAT THE RING IS SWOLLEN ABOVE THE RING -  TRK#:9319
(FALL)\n819 HEN VALLEY RD, OLIVER SPRINGS, TN, 37840 - CALL:FALL - REC:13:38 - DISP: - NOTE:CALLER STATES THAT HER MOTHER HAS FALLEN AND NEEDS HELP. SHE STATES THAT THEY CAN'T HER OUT OF THE FLOOR BECAUSE I -  TRK#:9320
(MEDICAL ASSIST)\n618 BUTLER MILL RD, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:02:38 - DISP:02:39 - NOTE:ANDERSON CO STATES THAT A 51 FEMALE HAS A MENTAL STATUS CHANGE. MEDIC 2 EN ROUTE -  TRK#:9363
(FIRE)\n222 PINE RIDGE RD, OLIVER SPRINGS, TN, 37840 - CALL:FIRE - REC:00:23 - DISP:00:23 - NOTE:ANDERSON CO REQUESTING AUTOMATIC AID FOR TRAILER FIRE AT 222 PINE RIDGE RD NEAR GIBBS LANE -  TRK#:9383
(MEDICAL ASSIST)\n1011 COX CIRCLE, OLIVER SPRINGS, TN, 37840 - CALL:MEDICAL ASSIST - REC:22:12 - DISP:22:12 - NOTE:ASSIST ANDERSON COUNTY EMS ON REPORT OF A 50 YOA MALE POSSIBLE STROKE AT 1011 COX CIRCLE. -  TRK#:9395
(FIRST REPSONDERS)\n401 VALLEY DRIVE , OLIVER SPRINGS, TN, 37840 - CALL:FIRST REPSONDERS  - REC:14:50 - DISP:14:50 - NOTE:SEXTON RESIDENCE 401 VALLEY DRIVE 46YOM DIFF BREATHING AND 104 TEMP  -  TRK#:9415

 */

public class TNOliverSpringsParser extends FieldProgramParser {
  
  private static final Pattern DELIM = Pattern.compile(" +- +");
  
  public TNOliverSpringsParser() {
    super("OLIVER SPRINGS", "TN",
           "ADDR! CALL:CALL! REC:SKIP! DISP:TIME! NOTE:INFO! TRK#:ID");
  }
  
  @Override
  public String getFilter() {
    return "page@ospd.com";
  }

  @Override
  protected boolean parseMsg(String subject, String body, Data data) {
    
     body = body.replace('\n', ' ');
     return parseFields(DELIM.split(body), 5, data);
  }

  private class MyAddressField extends AddressField {
    @Override
    public void parse(String field, Data data) {
      Parser p = new Parser(field);
      parseAddress(p.get(','), data);
      data.strCity = p.get(',');
      data.strState = p.get(',');
      if (data.strState.equals(data.defState)) data.strState = ""; 
    }
    
    @Override
    public String getFieldNames() {
      return "ADDR APT CITY ST";
    }
  }
  
  @Override
  public Field getField(String name) {
    if (name.equals("ADDR")) return new MyAddressField();
    return super.getField(name);
  }
}
