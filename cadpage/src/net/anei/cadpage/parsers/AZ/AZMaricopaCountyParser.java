
package net.anei.cadpage.parsers.AZ;

import java.util.Properties;

import net.anei.cadpage.parsers.FieldProgramParser;
import net.anei.cadpage.parsers.MsgInfo.Data;

/*
Mesa, AZ (Maricopa County)
Contact: support@active911.com
Contact: Eric Focht <eric.focht@mesaaz.gov> 
http://active911.com/interface/parser_report.php?key=340-2LucV
Sender:CAD ADMIN <cad.admin@mesaaz.gov>

(I/Page Notification) Location: 843 S LONGMORE MESA,1019: @DEL CORONADO AP EVENT: F2012031039 TYPE CODE: 909WORK CALLER NAME: FRITZY SALAZAR CALLER ADDR:  TIME: 20:58:16 Comments:  SPECIAL ADDRESS COMMENT: Grid: BC04 Plat: 14 Block: 1500 W SMOKE INSIDE APT 1019....FIRE ALARM SOUNDING ALSO ALARM SOUNDING FOR PAST HOUR. RESIDENTS NOT HOME AT THIS TIME ENROUTE CODE 3 RP LIVES UPSTAIRS JUST WENT TO CHECK AND CAN SEE SMOKE INSIDE ENROUTE CODE 3 ENROUTE CODE 3 POSS DOGS INSIDE ENROUTE CODE 3 ENROUTE CODE 3 5C14 -- NO FLAMES ALOT OF SMOKE...H/O 97 ENROUTE CODE 3 +++RESOURCE REQUEST+++ : WORKING FIRE 5C14 -- FOOD ON STOVE
(I/Page Notification) Location: 161 E 6TH PL MESA: @COMMUNICATIONS EVENT: F2012030962 TYPE CODE: CADTEST CALLER NAME:  CALLER ADDR:  TIME: 14:44:25 Comments:  SPECIAL ADDRESS COMMENT: Grid: AB11 Plat: 28 Block: 700 N TEST ENCODE DISREGARD PAGE....NO INCIDENT
(I/Page Notification) Location: 1198 S LINDSAY RD MESA,INT: @LINDSAY / SOUTHERN EVENT: F2012031101 TYPE CODE: 9622N1M CALLER NAME: CODY SCOTT CALLER ADDR:  TIME: 07:31:25 Comments:  SPECIAL ADDRESS COMMENT: Grid: BC17 Plat: 54 Block: 2800 E 2 VEHS ...BLOCKING ....UNK INJS ... #1 BLU CHEV TRUCK ...101 IS NOT CONSC ... VS WHI CAR ... JN OF SOUTHERN ... RP IS NOT WITNESS THIS RP SAYING AT LINDSAY/HAMPTON...JUST SOUTH THIS RP IS WITNESS...THOMAS BOSTNICK..480 338 1288 ENROUTE CODE 3 MY RP SAID THIS IS A HEAD ON COLLISON .. THIS RP IS WITNESS...NAME IS ERIC WAHLBERG....602 909 3123 ENROUTE CODE 2 THIS RP HEARD THAT THERE ARE TWO PT'S LOC BUT IS NOT WITH THEM TO CONFIRM ARRIVE - ARRIVE HEAVY DAMAGE... UPGRADE TO 2N1M.. .TRAFFIC TO CH2
(I/Page Notification) Location: 400 N GILBERT RD MESA,INT: @GILBERT RD / UNIVERSITY EVENT: F2012031230 TYPE CODE: 9622N1M CALLER NAME: JENNY CALLER ADDR:  TIME: 15:37:05 Comments:  SPECIAL ADDRESS COMMENT: Grid: AB15 Plat: 44 Block: 2000 E MC VS VEH ... MALE IS DOWN BLEEDING ....MC IS ON FIRE .... JUST WEST MC IS ON FIRE MC RIDER WAS ON FIRE S55 JW OF GILBERT RD... ON UNIVERSITY... INFRONT OF WELLS FARGO THIS RP STATING MC IS ON FIRE NOT RIDER .....MC RIDER BLEEDING FROM HEAD .... WHI TRUCK INVOLVED ... PEOPLE ARE STOPPING AND TRYING TO HELP MALE IS NOT BREATHING .. ++++++NOT BREATHING NO HELMET ANOTHER RP ADV THERE IS TRUCK ON FIRE AND CAN SEE SMOKE AND FLAMES CPR IS IN PROGRESS ... THIS RP IS WITNESS AT DAVID PHELPS AT 480 553-4219 UNK OTHER VEH INVOLVED.....JUST WEST....IN FRONT OF 1840 E UNIVERSITY.....THIS RP WITNESS, SAW THE MC RIDER FALL OFF THE MC, THIS RP REBECCA HAYNES, 480 709 8254 ENROUTE CODE 3 MY RP IS GIVING CHEST COMPRESSION RP IS NOT WITH PT ... ENROUTE CODE 2 RP IS MICHELLE BUTTON ...21/480-228-6908 MY RP IS JOE 911 ONLY CELL PHONE MC IS ON FIRE RP IS NOT INVOVLED OR W ANYONE INVOLVED
(I/Page Notification) Location: 2798 W GUADALUPE OFF S TEMP,INT: @101 S / GUADALUPE OFF EVENT: F2012031243 TYPE CODE: 2N1M CALLER NAME: UNK MALE CALLER ADDR:  TIME: 16:48:37 Comments:  SPECIAL ADDRESS COMMENT: Grid: BA07 Plat: 5 Block: N/A 101 SB N OF GUADALUPE Grid: BF08 Plat: 8 Block: N/A DPS NRT RP SYAING BLK VEH ROLLED ON ITS TOP UNK HOW MANY PT
(I/Page Notification) Location: 1198 S LINDSAY RD MESA,INT: @LINDSAY / SOUTHERN EVENT: F2012031101 TYPE CODE: 9622N1M CALLER NAME: CODY SCOTT CALLER ADDR:  TIME: 07:31:25 Comments:  SPECIAL ADDRESS COMMENT: Grid: BC17 Plat: 54 Block: 2800 E 2 VEHS ...BLOCKING ....UNK INJS ... #1 BLU CHEV TRUCK ...101 IS NOT CONSC ... VS WHI CAR ... JN OF SOUTHERN ... RP IS NOT WITNESS THIS RP SAYING AT LINDSAY/HAMPTON...JUST SOUTH THIS RP IS WITNESS...THOMAS BOSTNICK..480 338 1288 ENROUTE CODE 3 MY RP SAID THIS IS A HEAD ON COLLISON .. THIS RP IS WITNESS...NAME IS ERIC WAHLBERG....602 909 3123 ENROUTE CODE 2 THIS RP HEARD THAT THERE ARE TWO PT'S LOC BUT IS NOT WITH THEM TO CONFIRM ARRIVE - ARRIVE HEAVY DAMAGE... UPGRADE TO 2N1M.. .TRAFFIC TO CH2
(I/Page Notification) Location: 2646 E EL MORO AVE MESA EVENT: F2012031573 TYPE CODE: 909WORK CALLER NAME: CLAUDIA DIXON CALLER ADDR:  TIME: 00:33:46 Comments:  SPECIAL ADDRESS COMMENT: Grid: BC17 Plat: 54 Block: 900 S ELETRICAL FIRE ... INSIDE THE GARAGE ARRIVE - ARRIVE HUSB IS TRYING TO PUT IT OUT W/ EXTINGUISHER ... FLAMES & SMOKE SEEN ... ENROUTE CODE 3 ENROUTE CODE 3 ENROUTE CODE 2 COMING OUT OF THE PLUG ... OR POSS A LIGHT ... ENROUTE CODE 3 RP THINKS IT GOING INTO THE ATTIC ... ENROUTE CODE 3 THERE IS A ROOM ABOVE THE GARAGE ... ENROUTE CODE 3 EVERYONE HAS EVACUATED ... 4 SUBJS STANDING OUTSIDE ... S63 ENROUTE CODE 3 ===FIRE STARTED IN THE GARAGE AT THE LIGHT FIXTURE ... FLAMES WERE COMING OUT OF THE PLUG IN THE BEDROOM ABOVE THE GARAGE ... RP BELIEVES ITS IN THE WALLS GOING INTO THE ATTIC 6A57--A LOT OF SMOKE NO FLAMES E202 -- WORKING FIRE RESPONSE
(I/Page Notification) Location: 2000 N GREENFIELD RD MESA,INT: @MCKELLIPS / GREENFIELD EVENT: F2012031623 TYPE CODE: 9622N1M CALLER NAME: JANELLE FITZWATER CALLER ADDR:  TIME: 07:53:41 Comments:  SPECIAL ADDRESS COMMENT: Grid: AF21 Plat: 66 Block: 4400 E 2 VEHS...UNK INJS...BLOCKING... ONE VEH RAN RED LIGHT... NOW SAYING NOT BLOCKING...BOTH ENDED UP IN BUS STOP ON SIDE OF ROADWAY... THIS RP SAYS NOT BLOCKING....BUT DEBRIS OVER THE ROAD... NOW SAYING MEDICS NEEDED...UPGRADING GLD 2D PC...RAN RED...HIT RED FORD FOCUS... GLD PC VS BLK PC 4D THIS RP IS WITNESS THIS RP IS LADONA WELSH ...21/480-277-1012..NOT A WITNESS ENROUTE CODE 3 ELDERLY FEMALE WITH CUTS AND SCRAPES...MOSTLY SHAKEN UP ENROUTE CODE 3 ENROUTE CODE 2 ARRIVE - ARRIVE RP CB, FIRE 97, SAID TWO OCCUPANTS IN THE GOLD VEH ARRIVE - ARRIVE 1 ALS AND 1 904 C3 R +++RESOURCE REQUEST+++ : BALANCE TO 2N1M ENROUTE CODE 3 ENROUTE CODE 3 ENROUTE CODE 3

*/


public class AZMaricopaCountyParser extends FieldProgramParser {
  
  private static final Properties CITY_CODES = buildCodeTable(new String[]{
	"SCOT", "SCOTTSDALE",
	"SNLK", "SUN LAKES",
	"APJU", "APACHE JUNCTION",
	"CHAN", "CHANDLER",
	"GILB", "GILBERT",
	"MESA", "MESA",
	"PINA", "PINAL",
	"QNCR", "QUEEN CREEK",
	"TEMP", "TEMPE"
  });

  public AZMaricopaCountyParser() {
    super(CITY_CODES, "MARICOPA COUNTY", "AZ",
           "Location:ADDR/S! EVENT:ID! TYPE_CODE:CALL! CALLER_NAME:NAME! CALLER_ADDR:SKIP! TIME:TIME! Comments:INFO SPECIAL_ADDRESS_COMMENT:INFO? Grid:MAP Plat:MAP Block:INFO");
    
    
  }
  @Override
  public String getFilter() {
    return "cad.admin@mesaaz.gov";
  }
  
  private class MyAddressField extends AddressField {
    @Override
    public void parse(String field, Data data) {
      Parser p = new Parser(field);
      String extra = p.getLastOptional(": @");
      String apt = p.getLastOptional(',');
      super.parse(p.get(), data);
      
      if (apt.equals("INT")) {
        StringBuilder sb = new StringBuilder();
        for (String road : extra.split("/")) {
          road = road.trim();
          if (!data.strAddress.contains(road)) {
            if (sb.length() > 0) sb.append(" & ");
            sb.append(road);
          }
        }
        data.strCross = sb.toString();
      }
      
      else {
        data.strApt = apt;
        data.strPlace = extra;
      }
    }
    
    @Override
    public String getFieldNames() {
      return super.getFieldNames() + " APT PLACE X";
    }
  }

  private class MyMapField extends MapField {
    @Override
    public void parse(String field, Data data) {
      data.strMap = append(data.strMap, "-", field);
    }
  }
  
  @Override
  public Field getField(String name) {
    if (name.equals("ADDR")) return new MyAddressField();
    if (name.equals("MAP")) return new MyMapField();
    return super.getField(name);
  }
}
