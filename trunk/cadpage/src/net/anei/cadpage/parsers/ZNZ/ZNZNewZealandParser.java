package net.anei.cadpage.parsers.ZNZ;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import net.anei.cadpage.parsers.MsgInfo.Data;
import net.anei.cadpage.parsers.SmartAddressParser;


public class ZNZNewZealandParser extends SmartAddressParser {

  private static final Pattern END_PAGE_BREAK = Pattern.compile("#F\\d+(?=\n)");
  private static final Pattern MASTER =
      Pattern.compile("\\(([A-Z0-9, ]+)\\) *([A-Z0-9]+-[A-Z]+) (?:\\((Alarm Type [-A-Z0-9/ ]+)\\) *)?(?:\\(Box ([-A-Z0-9 &]+)\\) *)?([-A-Za-z0-9\\(\\)\\.\\\\ ]+?) *\\. *(?:((?:NEAR|OFF) [- A-Z0-9]+)\\. *)?(?:\\(XStr +([-A-Z0-9/ ]*)\\) *)?(?:\\.([-A-Z0-9 /\\.:]+)\\. *)?(?:\\(x-\\d+ y-\\d+\\) *)?#(F\\d+)");
  private static final Pattern UNKNNNNN = Pattern.compile("\\bUNKN\\d{4}\\b");

  public ZNZNewZealandParser() {
    super(CITY_LIST, "", "", CountryCode.NZ);
    setupMultiWordStreets(
        "GREAT NORTH"
    );
  }
  
  @Override
  public String getFilter() {
    return "silv@vodafone.co.nz,pager@firehouse.co.nz";
  }

  @Override
  public String getLocName() {
    return "New Zealand";
  }

  @Override
  protected boolean parseMsg(String subject, String body, Data data) {
    if (subject.length() > 0) body = '(' + subject + ") " + body;
    Matcher match = END_PAGE_BREAK.matcher(body);
    if (match.find()) body = body.substring(0,match.end());
    body = body.replace('\n', ' ');
    match = MASTER.matcher(body);
    if (!match.matches()) return false;

    int ndx = 1;
    data.strUnit = match.group(ndx++).trim();
    data.strCode = match.group(ndx++).trim();
    data.strCall = getOptGroup(match.group(ndx++));
    data.strBox = getOptGroup(match.group(ndx++));
    String sAddr = match.group(ndx++).trim();
    sAddr = UNKNNNNN.matcher(sAddr).replaceAll("@");
    parseAddress(StartType.START_PLACE, FLAG_ANCHOR_END, sAddr, data);
    data.strPlace = append(data.strPlace, " ", getOptGroup(match.group(ndx++)));
    String cross = getOptGroup(match.group(ndx++));
    if (cross.endsWith("/")) cross = cross.substring(0,cross.length()-1).trim();
    data.strCross = cross;
    data.strCall = append(data.strCall, " / ", getOptGroup(match.group(ndx++)));
    if (data.strCall.length() == 0) return false;
    data.strCallId = match.group(ndx++);
    
    // Sometimes an intersection is reported as a cross street. 
    if (data.strAddress.length() == 0) {
      parseAddress(data.strCross, data);
      data.strCross = "";
    }
    
    return true;
  }

  private static final String[] CITY_LIST = new String[]{
    
    // Towns of new Zealand
    "AHAURA",
    "AHIPARA",
    "AHITITI",
    "AHUROA",
    "AKAROA",
    "AKITIO",
    "ALBANY",
    "ALBERT TOWN",
    "ALBURY",
    "ALEXANDRA",
    "ALLANTON",
    "AMBERLEY",
    "ANAKIWA",
    "ARANGA",
    "ARAMOANA",
    "ARAPOHUE",
    "ARMY BAY",
    "ARROWTOWN",
    "ARUNDEL",
    "ASHBURTON",
    "ASHHURST",
    "ASHLEY",
    "AUCKLAND",
    "AUROA",
    "AWANUI",
    "BALCLUTHA",
    "BALFOUR",
    "BARRYTOWN",
    "BEACHLANDS",
    "BEAUMONT",
    "BELL BLOCK",
    "BENHAR",
    "BENNEYDALE",
    "BLACKBALL",
    "BLENHEIM",
    "BLUFF",
    "BRIGHTON",
    "BRIGHTWATER",
    "BROADWOOD",
    "BULLS",
    "BUNNYTHORPE",
    "CAMBRIDGE",
    "CANVASTOWN",
    "CARTERTON",
    "CHEVIOT",
    "CHRISTCHURCH",
    "CLARKSVILLE",
    "CLINTON",
    "CLIVE",
    "CLYDE",
    "COATESVILLE",
    "COLLINGWOOD",
    "COLVILLE",
    "COROGLEN",
    "COROMANDEL",
    "CROMWELL",
    "CULVERDEN",
    "CUST",
    "DAIRY FLAT",
    "DANNEVIRKE",
    "DARFIELD",
    "DARGAVILLE",
    "DOBSON",
    "DRURY",
    "DUNEDIN",
    "DUNTROON",
    "EASTBOURNE",
    "EDENDALE",
    "EDGECUMBE",
    "EGMONT VILLAGE",
    "EKETAHUNA",
    "ELTHAM",
    "ETTRICK",
    "FAIRHALL",
    "FAIRLIE",
    "FEATHERSTON",
    "FEILDING",
    "FLAXMERE",
    "FOX GLACIER",
    "FOXTON",
    "FOXTON BEACH",
    "FRANKTON",
    "FRANKTON",
    "FRANZ JOSEF",
    "GERALDINE",
    "GISBORNE",
    "GLENORCHY",
    "GORE",
    "GRANITY",
    "GREYMOUTH",
    "GREYTOWN",
    "GROVETOWN",
    "GULF HARBOUR",
    "HAAST",
    "HAKATARAMEA",
    "HALCOMBE",
    "HAMILTON",
    "HAMPDEN",
    "HANMER SPRINGS",
    "HARI HARI",
    "HASTINGS",
    "HAUPIRI",
    "HAVELOCK",
    "HAVELOCK NORTH",
    "HAWEA",
    "HAWERA",
    "HELENSVILLE",
    "HENLEY",
    "HERBERT",
    "HEREKINO",
    "HIKUAI",
    "HIKURANGI",
    "HIKUTAIA",
    "HINUERA",
    "HOKITIKA",
    "HOPE",
    "HOREKE",
    "HOUHORA",
    "HOWICK",
    "HUAPAI",
    "HUIAKAMA",
    "HUIRANGI",
    "HUKERENUI",
    "HUNTERVILLE",
    "HUNTLY",
    "HURLEYVILLE",
    "INANGAHUA JUNCTION",
    "INGLEWOOD",
    "INVERCARGILL",
    "JACOBS RIVER",
    "KAIAPOI",
    "KAIHU",
    "KAIKOHE",
    "KAIKOURA",
    "KAIMATA",
    "KAINGAROA",
    "KAKANUI",
    "KAIPARA FLATS",
    "KAITAIA",
    "KAITANGATA",
    "KAIWAKA",
    "KAKARAMEA",
    "KANIERE",
    "KAPONGA",
    "KARAMEA",
    "KARETU",
    "KARITANE",
    "KATIKATI",
    "KAUKAPAKAPA",
    "KAURI",
    "KAWAKAWA",
    "KAWERAU",
    "KENNEDY BAY",
    "KERIKERI",
    "KIHIKIHI",
    "KINLOCH",
    "KINGSTON",
    "KOKATAHI",
    "KOKOPU",
    "KOROMIKO",
    "KUMARA",
    "KUMEU",
    "KUROW",
    "LAWRENCE",
    "LEESTON",
    "LEIGH",
    "LEPPERTON",
    "LEVIN",
    "LINCOLN",
    "LINKWATER",
    "LITTLE RIVER",
    "LOWER HUTT",
    "LUGGATE",
    "LUMSDEN",
    "LYTTELTON",
    "MAKAHU",
    "MANAIA",
    "MANAIA",
    "MANAKAU",
    "MANAPOURI",
    "MANGAKINO",
    "MANGAMUKA",
    "MANGATOKI",
    "MANGAWHAI",
    "MANUKAU",
    "MANUREWA",
    "MANUTAHI",
    "MAPUA",
    "MARAETAI",
    "MARCO",
    "MAROMAKU",
    "MARSDEN BAY",
    "MARTINBOROUGH",
    "MARTON",
    "MARUIA",
    "MASTERTON",
    "MATAKANA",
    "MATAKOHE",
    "MATAMATA",
    "MATAPU",
    "MATARANGI",
    "MATARAU",
    "MATATA",
    "MATAURA",
    "MATIHETIHE",
    "MAUNGAKARAMEA",
    "MAUNGATAPERE",
    "MAUNGATUROTO",
    "MAYFIELD",
    "MEREMERE",
    "METHVEN",
    "MIDDLEMARCH",
    "MIDHIRST",
    "MILLERS FLAT",
    "MILTON",
    "MIMI",
    "MOANA",
    "MOENUI",
    "MOERAKI",
    "MOEREWA",
    "MOKAU",
    "MOKOIA",
    "MORRINSVILLE",
    "MOSGIEL",
    "MOSSBURN",
    "MOTATAU",
    "MOTUEKA",
    "MOUNT MAUNGANUI",
    "MOUNT SOMERS",
    "MURCHISON",
    "MURUPARA",
    "NAPIER",
    "NASEBY",
    "NELSON",
    "NEW BRIGHTON",
    "NEW PLYMOUTH",
    "NORMANBY",
    "NGAERE",
    "NGAMATAPOURI",
    "NGAPARA",
    "NGARUAWAHIA",
    "NGATAKI",
    "NGONGOTAHA",
    "NGUNGURU",
    "NIGHTCAPS",
    "NORFOLK",
    "OAKURA",
    "OAMARU",
    "OBAN",
    "OHAKUNE",
    "OHAEAWAI",
    "OHANGAI",
    "OHOKA",
    "OHOPE BEACH",
    "OHURA",
    "OKAIHAU",
    "OKATO",
    "OMANAIA",
    "OMARAMA",
    "OMATA",
    "OMOKOROA",
    "ONEWHERO",
    "OPONONI",
    "OPOTIKI",
    "OPUA",
    "OPUNAKE",
    "ORATIA",
    "OREWA",
    "OROMAHOE",
    "ORUAITI",
    "OTAIKA",
    "OTAKI",
    "OTAKOU",
    "OTAUTAU",
    "OTIRIA",
    "OTOROHANGA",
    "OWAKA",
    "OXFORD",
    "PAPARORE",
    "PAEKAKARIKI",
    "PAEROA",
    "PAHIATUA",
    "PAIHIA",
    "PAKARAKA",
    "PAKIRI",
    "PAKOTAI",
    "PALMERSTON",
    "PALMERSTON NORTH",
    "PAMAPURIA",
    "PANGURU",
    "PAPAKURA",
    "PAPAMOA",
    "PAPAROA",
    "PAPATOETOE",
    "PARAKAI",
    "PARAPARAUMU",
    "PAREMOREMO",
    "PAREORA",
    "PAROA",
    "PARUA BAY",
    "PATEA",
    "PAUANUI",
    "PAUATAHANUI",
    "PEKA PEKA",
    "PEMBROKE",
    "PERIA",
    "PETONE",
    "PICTON",
    "PIOPIO",
    "PIPIWAI",
    "PIRONGIA",
    "PLEASANT POINT",
    "PLIMMERTON",
    "PORIRUA",
    "PORTLAND",
    "POROTI",
    "PORT CHALMERS",
    "PORTOBELLO",
    "PUKEKOHE",
    "PUKERUA BAY",
    "PUKEURI",
    "PUKEPOTO",
    "PURUA",
    "PUTARURU",
    "QUEENSTOWN",
    "RAETIHI",
    "RAGLAN",
    "RAHOTU",
    "RAI VALLEY",
    "RAMARAMA",
    "RANFURLY",
    "RANGIORA",
    "RAPAURA",
    "RATAPIKO",
    "RAUMATI",
    "RAWENE",
    "RAWHITIROA",
    "REEFTON",
    "RENWICK",
    "RICHMOND",
    "RIVERHEAD",
    "RIVERLANDS",
    "RIVERSDALE BEACH",
    "RIVERTON",
    "RIWAKA",
    "ROLLESTON",
    "ROSS",
    "ROTORUA",
    "ROXBURGH",
    "RUATORIA",
    "RUAWAI",
    "RUNANGA",
    "RUSSELL",
    "SAINT ANDREWS CANTERBURY",
    "SAINT ARNAUD",
    "SAINT BATHANS",
    "SANSON",
    "SEACLIFF",
    "SEDDON",
    "SEDDONVILLE",
    "SHEFFIELD",
    "SHANNON",
    "SILVERDALE",
    "SNELLS BEACH",
    "SPRINGFIELD",
    "SPRINGSTON",
    "SPRING CREEK",
    "STIRLING",
    "STRATFORD",
    "TAHAROA",
    "TAIERI MOUTH",
    "TAIHAPE",
    "TAIPA-MANGONUI",
    "TAIRUA",
    "TAKAKA",
    "TANGITERORIA",
    "TAPANUI",
    "TAPU",
    "TANGOWAHINE",
    "TAPAWERA",
    "TAPORA",
    "TARADALE",
    "TAUHOA",
    "TAUMARUNUI",
    "TAUPAKI",
    "TAUPO",
    "TAURANGA",
    "TAURAROA",
    "TAUTORO",
    "TE ANAU",
    "TE ARAI",
    "TE AROHA",
    "TE AWAMUTU",
    "TE HAPUA",
    "TE HORO",
    "TE KAO",
    "TE KOPURU",
    "TE KUITI",
    "TE POI",
    "TE PUKE",
    "TE PURU",
    "TEMUKA",
    "TE RERENGA",
    "THAMES",
    "TIKORANGI",
    "TIMARU",
    "TINOPAI",
    "TINWALD",
    "TIRAU",
    "TITOKI",
    "TOKARAHI",
    "TOKO",
    "TOKANUI",
    "TOKOROA",
    "TOLAGA BAY",
    "TOMARATA",
    "TOWAI",
    "TUAKAU",
    "TUAMARINA",
    "TUATAPERE",
    "TURANGI",
    "TWIZEL",
    "UMAWERA",
    "UPPER HUTT",
    "UPPER MOUTERE",
    "URENUI",
    "URUTI",
    "WADDINGTON",
    "WAIHEKE ISLAND",
    "WAHAROA",
    "WAIHARARA",
    "WAIHI",
    "WAIHI BEACH",
    "WAIHOLA",
    "WAIKANAE",
    "WAIKAWA",
    "WAIKAWA",
    "WAIKOUAITI",
    "WAIMA",
    "WAIMANGAROA",
    "WAIMATE",
    "WAIMATE NORTH",
    "WAIMAUKU",
    "WAINUI",
    "WAINUIOMATA",
    "WAIONEKE",
    "WAIOURU",
    "WAIOTIRA",
    "WAIPAWA",
    "WAIPUKURAU",
    "WAIRAKEI",
    "WAIRAU VALLEY",
    "WAIROA",
    "WAITAHUNA",
    "WAIKOUAITI",
    "WAIKUKU",
    "WAITARA",
    "WAITARIA BAY",
    "WAITATI",
    "WAITOA",
    "WAITOKI",
    "WAITORIKI",
    "WAITOTARA",
    "WAIUKU",
    "WAIWERA",
    "WAKEFIELD",
    "WALLACETOWN",
    "WALTON",
    "WAVERLEY",
    "WANAKA",
    "WARD",
    "WARDVILLE",
    "WARRINGTON",
    "WARKWORTH",
    "WELLINGTON",
    "WELLSFORD",
    "WESTPORT",
    "WESTON",
    "WHAKATANE",
    "WHAKAMARU",
    "WHANANAKI",
    "WHANGAMATA",
    "WHANGAMOMONA",
    "WHANGANUI",
    "WHANGAREI",
    "WHANGAREI HEADS",
    "WHANGARURU",
    "WHATAROA",
    "WHATUWHIWHI",
    "WHENUAKITE",
    "WHENUAKURA",
    "WHIRITOA",
    "WHITFORD",
    "WHITBY",
    "WHITIANGA",
    "WILLOWBY",
    "WIMBLEDON",
    "WINCHESTER",
    "WINDSOR",
    "WINDWHISTLE",
    "WINSCOMBE",
    "WINTON",
    "WOODEND",
    "WOODHILL",
    "WOODVILLE",
    "WYNDHAM",
    
    // Suburbs of Aukland
    // Aukland Isthamus
    "ARCH HILL",
    "AVONDALE",
    "BLOCKHOUSE BAY",
    "BALMORAL",
    "EDEN TERRACE",
    "EDEN VALLEY",
    "ELLERSLIE",
    "EPSOM",
    "FREEMANS BAY",
    "GLENDOWIE",
    "GLEN INNES",
    "GRAFTON",
    "GREENLANE",
    "GREENWOODS CORNER",
    "GREY LYNN",
    "HERNE BAY",
    "HILLSBOROUGH",
    "KINGSLAND",
    "KOHIMARAMA",
    "LYNFIELD",
    "MEADOWBANK",
    "MISSION BAY",
    "MORNINGSIDE",
    "MOUNT ALBERT",
    "MOUNT EDEN",
    "MOUNT ROSKILL",
    "MOUNT WELLINGTON",
    "NEWMARKET",
    "NEWTON",
    "NEW WINDSOR",
    "ONEHUNGA",
    "ONE TREE HILL",
    "ORAKEI",
    "ORANGA",
    "OTAHUHU",
    "OWAIRAKA",
    "PANMURE",
    "PARNELL",
    "PENROSE",
    "POINT ENGLAND",
    "POINT CHEVALIER",
    "PONSONBY",
    "REMUERA",
    "ROYAL OAK",
    "SAINT HELIERS",
    "SAINT JOHNS",
    "SAINT MARYâ€™S BAY",
    "SANDRINGHAM",
    "TAMAKI",
    "TE PAPAPA",
    "THREE KINGS",
    "WAIKOWHAI",
    "WATERVIEW",
    "WESTFIELD",
    "WESTMERE",
    
    // North Shore
    "ALBANY",
    "BAYSWATER",
    "BEACH HAVEN",
    "BELMONT",
    "BIRKDALE",
    "BIRKENHEAD",
    "BROWNS BAY",
    "CAMPBELLS BAY",
    "CASTOR BAY",
    "CHATSWOOD",
    "CROWN HILL",
    "CUTHILL",
    "DEVONPORT",
    "FAIRVIEW",
    "FORREST HILL",
    "GLENFIELD",
    "GLENVAR",
    "GREENHITHE",
    "HIGHBURY",
    "HILLCREST",
    "LONG BAY",
    "MAIRANGI BAY",
    "MARLBOROUGH",
    "MEADOWOOD",
    "MILFORD",
    "MURRAYS BAY",
    "NORTHCOTE",
    "NORTHCOTE CENTRAL",
    "NORTHCOTE POINT",
    "NORTH HARBOUR",
    "ROSEDALE",
    "ROTHESAY BAY",
    "OTEHA",
    "PINEHILL",
    "STANLEY BAY",
    "SUNNYNOOK",
    "TAKAPUNA",
    "TORBAY",
    "WAIAKE",
    "WAIRAU VALLEY",
    "WESTLAKE",
    "WINDSOR PARK",
    "UNSWORTH HEIGHTS",

    // South AUkland and Eastern Suburbs
    "AIRPORT OAKS",
    "BEACHLANDS",
    "BROOKBY",
    "BUCKLANDS BEACH",
    "CHAPEL DOWNS",
    "CLENDON",
    "CLEVEDON",
    "CLOVER PARK",
    "COCKLE BAY",
    "DANNEMORA",
    "EAST TAMAKI",
    "EASTERN BEACH",
    "FARM COVE",
    "FLAMBORO HEIGHTS",
    "FLAT BUSH",
    "GOLFLANDS",
    "GOODWOOD HEIGHTS",
    "GREENMEADOWS",
    "HALF MOON BAY",
    "HERON POINT",
    "HIGHLAND PARK",
    "HILL PARK",
    "HOWICK",
    "MAHIA PARK",
    "MANGERE",
    "MANGERE BRIDGE",
    "MANGERE EAST",
    "MANUKAU",
    "MANUKAU HEIGHTS",
    "MANUREWA",
    "MARAETAI",
    "MEADOWLANDS",
    "MELLONS BAY",
    "MIDDLEMORE",
    "MURPHYS HEIGHTS",
    "NORTH PARK",
    "ORERE POINT",
    "OTARA",
    "PAKURANGA",
    "PAPATOETOE",
    "PORCHESTER PARK",
    "PUHINUI",
    "RANDWICK PARK",
    "REDOUBT PARK",
    "RICHMOND PARK",
    "SETTLERS COVE",
    "SHELLY PARK",
    "SILKWOOD HEIGHTS",
    "SOMMERVILLE",
    "THE GARDENS",
    "TOTARA HEIGHTS",
    "TUSCANY ESTATE",
    "WAIMAHIA LANDING",
    "WATTLE COVE",
    "WATTLE DOWNS",
    "WEYMOUTH",
    "WHITFORD",
    "WIRI",

    // Papakura
    "ALFRISTON",
    "ARDMORE",
    "CONIFER GROVE",
    "LONGFORD PARK",
    "MANUREWA EAST",
    "PAHUREHURE",
    "PAPAKURA",
    "OPAHEKE",
    "RED HILL",
    "ROSEHILL",
    "TAKANINI",

    // West Aukland
    "GLEN EDEN",
    "GLENDENE",
    "GREEN BAY",
    "HENDERSON",
    "HOBSONVILLE",
    "KELSTON",
    "KONINI",
    "LAINGHOLM",
    "MASSEY",
    "NEW LYNN",
    "ORATIA",
    "PIHA",
    "RANUI",
    "SUNNYVALE",
    "SWANSON",
    "TE ATATU",
    "TE ATATU PENINSULA",
    "TITIRANGI",
    "WAIATARUA",
    "WAITAKERE",
    "WEST HARBOUR",
    "WHENUAPAI",
    
    // Whangarei suburbs
    "KAMO",
    "TIKIPUNGA",
  };
}
