package net.anei.cadpage.parsers.KY;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import net.anei.cadpage.parsers.MsgInfo.Data;
import net.anei.cadpage.parsers.SmartAddressParser;

/*
Boyd County, KY
Contact: Active911
Agency name: Boyd County 912 Location: Ashland, KY 
Sender: BC911@BOYD.KY

BC911:65S FIRE-STRUCTURE 1016 TURLEY AVE GREENUP,COUNTY E911
BC911:20X DOMESTIC-INPROGRESS* 1500BLK HOODS CREEK PIKE US ROUTE 23 MOTORIST
BC911:20X DOMESTIC-INPROGRESS* 3274 COURT ST
BC911:32A ACCIDENT-INJURY* WB I64 MM 191 MOTORIST
BC911:20X DOMESTIC-INPROGRESS* 1004 TURKEY CT HARRIS, REX
BC911:20X DOMESTIC-INPROGRESS* 11512 MIDLAND TRL MOTORIST
BC911:09A ASSAULT-SUSPECT FLED 4505 MUSIC BR MIDLAND TRL DAMRON, RICKY
BC911:27X SUSP CIRCUMSTANCE-IN PROGRESS* 4901 ROBERSON RD RICE, ERIN
BC911:15X WEAPON VIOLATION-DISCHARGING* 231 NEW BUCKLEY RD ROBERTS DR NEWKIRK, WANDA
BC911:05A BURGLARY-SUSPECT FLED* 12108 MIDLAND TRL BROWN, JESSICA
BC911:32A ACCIDENT-INJURY* 10724 BRYAN DR EWING DR STEVENS, SARAH
BC911:65S FIRE-STRUCTURE 5600 SMALL BLVD PHILIS
BC911:26U UNATTENDED DEATH 7307 ST ROUTE 5 CHILDERS, HAROLD
BC911:65S FIRE-STRUCTURE 6411 ST ROUTE 3 WHEELER, TOM & KAREN
BC911:24B FIGHT-WEAPON INVOLVED* 21415 JACKS FRK ST ROUTE 854 JONES, RYAN
BC911:05X BURGLARY-INPROGRESS * 1592 GREENTREE CT Apt: L22 Bldg WOLOHAN DR WHEAT, DAVID
BC911:32A ACCIDENT-INJURY* 3727 CANNONSBURG RD MIDLAND TRL CORNWELL, WOODY
BC911:32A ACCIDENT-INJURY* INTERSTATE 64 MM 182 WB AT&T MOBILITY
BC911:27X SUSP CIRCUMSTANCE-IN PROGRESS* 1509 FOSSON ST FRENCH BROAD ST FEEMALE
BC911:09X ASSAULT-IN PROGRESS * 8309 NEW RIDGE RD HILLARD, ROBERT
BC911:65S FIRE-STRUCTURE 299 LEE ST WESTVIEW DR NELSON,MR
BC911:06X THEFT-IN PROGRESS* INTERSTATE 64 RICE, BEN
BC911:20X DOMESTIC-INPROGRESS* 321 VANBIBBER DR Apt: 4 Bldg BURTON, JESSICA
BC911:27X SUSP CIRCUMSTANCE-IN PROGRESS* 2900BLK LEXINGTON AVE
BC911:27X SUSP CIRCUMSTANCE-IN PROGRESS* UNRUE ST
BC911:32A ACCIDENT-INJURY* 4500 ROBERTS DR
BC911:26S SUICIDE-THREATS/ATTEMPT* 1000 COMMANCHE DR ISON, JENNY
BC911:06X THEFT-IN PROGRESS* 181MM INTERSTATE 64 REFUSAL
BC911:32A ACCIDENT-INJURY* 11000BLK ST ROUTE 5 US ROUTE 60 W COMMONWEALTH OF KY
BC911:26U UNATTENDED DEATH 140 PINECREST DR LEE, CHRISTY
BC911:15X WEAPON VIOLATION-DISCHARGING* GOLDIE CT RUCKER RD REFUSAL
BC911:32A ACCIDENT-INJURY* 1952 MARSH HILL DR ADKINS, LEIGH ANN
BC911:32B ACCIDENT-INJURY ROAD CLEAR* SUPER QUIK OHLINGER,TRAVIS
BC911:09A ASSAULT-SUSPECT FLED 6001 CRIDER DR US ROUTE 23 ADKINS, VALERIE
BC911:65S FIRE-STRUCTURE 16740 INDIAN TRL ST ROUTE 3 MORNINGSTAR, KAREN THOMPSON
BC911:15X WEAPON VIOLATION-DISCHARGING* 4014 STRAIGHT CRK BEAMAN, PATRICK
BC911:30R ALARM-ROBBERY* 7134 CANNONSBURG RD LAKIN DR ADT
BC911:30R ALARM-ROBBERY* 1448 FAIRWAY DR REIKERT DR NEWTECH
BC911:15X WEAPON VIOLATION-DISCHARGING* 5723 DANIELS FRK ST ROUTE 5 REEVES, JAMES
BC911:65S FIRE-STRUCTURE 622 GREENHILL RD HOENIG RD 9506
BC911:65S FIRE-STRUCTURE 2114 NEW BUCKLEY RD ROBERTS DR KNIGHT, SCOTT
BC911:26S SUICIDE-THREATS/ATTEMPT* 240 ST ROUTE 716 GREENE, LINZEY
BC911:05X BURGLARY-INPROGRESS * 923 TAYLOR DR NEIGHBOR
BC911:32A ACCIDENT-INJURY* 6015 US ROUTE 60 KSP
BC911:15X WEAPON VIOLATION-DISCHARGING* 2313 ROCKHOUSE RD ST ROUTE 5 DUNAWAY, STEPHANIE
BC911:20X DOMESTIC-INPROGRESS* 1900 MAIN ST Apt: BOTTOM Bldg WHEATLEY RD ROBERTS, BRAD
BC911:65S FIRE-STRUCTURE 26365 BOLTS FRK ST ROUTE 3 HAZLETT, ROBERTA
BC911:05A BURGLARY-SUSPECT FLED* 1798 MAPLE TREE CT Apt: L20 Bldg DONTA RD LEWIS, KATHERINE

*/
public class KYBoydCountyParser extends SmartAddressParser {
  
  private static final Pattern MASTER = Pattern.compile("BC911:([A-Z0-9]{3}) (?:([-A-Z ]+\\*) )?(.*)");
  private static final Pattern FRK_ST_PTN = Pattern.compile("\\bFRK ST\\b"); 
 
  public KYBoydCountyParser() {
    super("BOYD COUNTY", "KY");
  }
  
  @Override
  public String getFilter() {
    return "BC911@BOYD.KY";
  }
  
  @Override
  protected boolean parseMsg(String body, Data data) {
    
    Matcher match = MASTER.matcher(body);
    if (!match.matches()) return false;
    
    data.strUnit = match.group(1);
    String call = match.group(2);
    String addr = match.group(3);
    
    StartType st = StartType.START_CALL;
    if (call != null) {
      data.strCall = call.trim();
      st = StartType.START_ADDR;
    }
    
    int flags = 0;
    int pt = addr.indexOf(" Apt: ");
    if (pt > 0) {
      flags = FLAG_ANCHOR_END;
      String info = addr.substring(pt+6).trim();
      addr = addr.substring(0,pt).trim();

      Parser p = new Parser(info);
      data.strApt = p.getOptional(" Bldg");
      if (data.strApt.length() == 0) data.strApt = p.get(' ');
      data.strSupp = p.get();
    }
    
    parseAddress(st, flags | FLAG_IMPLIED_INTERSECT, addr, data);
    if (flags == 0) data.strSupp = getLeft();
    
    data.strAddress = FRK_ST_PTN.matcher(data.strAddress).replaceAll("FORK RD");
    
    return true;
  }
}
